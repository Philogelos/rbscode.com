<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>RBS Code Studio</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#0b1026;
  color:white;
  font-family:Arial;
  overflow:hidden;
}

.topbar{
  height:50px;
  display:flex;
  align-items:center;
  padding:0 12px;
  gap:10px;
  background:#111633;
  border-bottom:1px solid #222;
}

button{
  padding:6px 10px;
  border-radius:6px;
  border:none;
  cursor:pointer;
  font-weight:bold;
}

.run{ background:#7c3aed; color:white; }
.save{ background:#22d3ee; }

.tabs button{
  background:#222;
  color:#aaa;
}
.tabs button.active{
  background:#7c3aed;
  color:white;
}

.main{
  display:flex;
  height:calc(100% - 50px);
}

#editor{
  width:60%;
  height:100%;
}

#preview{
  width:40%;
  height:100%;
  border:none;
  background:white;
}
</style>
</head>
<body>

<div class="topbar">
  <div class="tabs">
    <button class="active" data-lang="html">HTML</button>
    <button data-lang="css">CSS</button>
    <button data-lang="javascript">JS</button>
  </div>
  <button class="run">Run</button>
  <button class="save">Save</button>
  <span id="status">Ready</span>
</div>

<div class="main">
  <div id="editor"></div>
  <iframe id="preview"></iframe>
</div>

<!-- OFFICIAL MONACO LOADER -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.min.js"></script>

<script>
require.config({
  paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs' }
});

require(['vs/editor/editor.main'], function () {

  const models = {
    html: monaco.editor.createModel(
`<h1>Hello RBS Code</h1>
<p>Start typing...</p>`,
    "html"),

    css: monaco.editor.createModel(
`body{
  font-family:Arial;
  text-align:center;
  padding:30px;
}`, "css"),

    javascript: monaco.editor.createModel(
`console.log("Ready");`, "javascript")
  };

  const editor = monaco.editor.create(document.getElementById('editor'), {
    model: models.html,
    theme: "vs-dark",
    automaticLayout:true,
    minimap:{enabled:false},
    fontSize:14
  });

  let activeLang = "html";

  // TAB SWITCH
  document.querySelectorAll(".tabs button").forEach(btn=>{
    btn.onclick = () => {
      document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      activeLang = btn.dataset.lang;
      editor.setModel(models[activeLang]);
    }
  });

  // RUN
  document.querySelector(".run").onclick = () => {
    const html = models.html.getValue();
    const css = models.css.getValue();
    const js = models.javascript.getValue();

    document.getElementById("preview").srcdoc =
`<style>${css}</style>
${html}
<script>
try{
${js}
}catch(e){
  document.body.innerHTML += "<pre style='color:red'>JS Error: "+e.message+"</pre>";
}
<\/script>`;
  };

  // SAVE
  document.querySelector(".save").onclick = () => {
    localStorage.setItem("rbs_html", models.html.getValue());
    localStorage.setItem("rbs_css", models.css.getValue());
    localStorage.setItem("rbs_js", models.javascript.getValue());
    document.getElementById("status").innerText = "Saved";
  };

  // LOAD IF EXISTS
  if(localStorage.getItem("rbs_html")){
    models.html.setValue(localStorage.getItem("rbs_html"));
    models.css.setValue(localStorage.getItem("rbs_css"));
    models.javascript.setValue(localStorage.getItem("rbs_js"));
  }

  // SIMPLE EMULATION OF "p â†’ <p></p>"
  monaco.languages.registerCompletionItemProvider("html", {
    triggerCharacters: "abcdefghijklmnopqrstuvwxyz".split(""),
    provideCompletionItems: function(model, position){
      const word = model.getWordUntilPosition(position).word;
      if(!word) return {suggestions:[]};

      const tags = ["p","div","span","h1","h2","button","ul","li","section"];

      if(!tags.includes(word)) return {suggestions:[]};

      return {
        suggestions: [{
          label: word,
          kind: monaco.languages.CompletionItemKind.Snippet,
          insertText: `<${word}>$0</${word}>`,
          insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
          range: new monaco.Range(
            position.lineNumber,
            position.column - word.length,
            position.lineNumber,
            position.column
          )
        }]
      };
    }
  });

});
</script>

</body>
</html>
