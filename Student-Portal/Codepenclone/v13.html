<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RBS Code Studio</title>

<style>
html,body{height:100%;margin:0;font-family:system-ui;background:#0f1220;color:#fff;overflow:hidden}
.topbar{
  display:flex;align-items:center;gap:12px;padding:10px 16px;
  background:#151935;border-bottom:1px solid #222
}
.brand{font-weight:700;font-size:14px;letter-spacing:.5px}
.spacer{flex:1}
button{
  background:#1f254d;border:1px solid #2c3370;color:#fff;
  padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:600
}
button:hover{background:#2c3370}
.tabs{display:flex;gap:6px}
.tab{padding:6px 10px;background:#1a1f3a;border-radius:6px;cursor:pointer;font-size:12px}
.tab.active{background:#3a44a3}
.main{display:grid;grid-template-columns:1fr 1fr;height:calc(100% - 50px)}
.editorWrap{height:100%}
#editor{height:100%}
.previewWrap{height:100%;border-left:1px solid #222}
iframe{width:100%;height:100%;border:none;background:#fff}
.fullPreview{
  position:fixed;inset:0;background:#000;z-index:9999
}
.fullPreview iframe{height:100%}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">RBS Code Studio</div>

  <div class="tabs">
    <div class="tab active" data-lang="html">HTML</div>
    <div class="tab" data-lang="css">CSS</div>
    <div class="tab" data-lang="javascript">JS</div>
  </div>

  <div class="spacer"></div>

  <button id="runBtn">Run</button>
  <button id="saveBtn">Save</button>
  <button id="downloadBtn">Download</button>
  <button id="fullBtn">Full Preview</button>
</div>

<div class="main">
  <div class="editorWrap"><div id="editor"></div></div>
  <div class="previewWrap"><iframe id="preview"></iframe></div>
</div>

<!-- Monaco Loader -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.min.js"></script>
<script>
require.config({
  paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs"}
});

require(["vs/editor/editor.main"], function(){

  // Enable Emmet
  monaco.languages.html.htmlDefaults.setOptions({
    format:{wrapLineLength:120},
    suggest:{html5:true}
  });
  monaco.languages.html.htmlDefaults.setModeConfiguration({
    completionItems:true
  });

  // Enable Emmet expansion
  monaco.languages.registerCompletionItemProvider("html", {
    provideCompletionItems: function(model, position){
      const textUntilPosition = model.getValueInRange({
        startLineNumber:1,
        startColumn:1,
        endLineNumber:position.lineNumber,
        endColumn:position.column
      });
      const word = textUntilPosition.split(/\s/).pop();
      if(!word) return {suggestions:[]};
      return {
        suggestions:[
          {
            label: word,
            kind: monaco.languages.CompletionItemKind.Snippet,
            insertText: `<${word}></${word}>`,
            insertTextRules:
              monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
            range: undefined
          }
        ]
      };
    }
  });

  const DEFAULT = {
    html:`<h1>Hello RBS Code</h1>
<button id="btn">Click me</button>
<p>Clicks: <span id="count">0</span></p>`,

    css:`body{
  text-align:center;
  font-family:Arial;
  padding:40px;
}`,

    javascript:`let count = 0;

document.getElementById("btn")
.addEventListener("click",()=>{
  count++;
  document.getElementById("count").innerText = count;
});`
  };

  const models = {
    html: monaco.editor.createModel(DEFAULT.html,"html"),
    css: monaco.editor.createModel(DEFAULT.css,"css"),
    javascript: monaco.editor.createModel(DEFAULT.javascript,"javascript")
  };

  const editor = monaco.editor.create(
    document.getElementById("editor"),
    {
      model:models.html,
      theme:"vs-dark",
      fontSize:14,
      minimap:{enabled:false},
      automaticLayout:true
    }
  );

  // Tab switching
  document.querySelectorAll(".tab").forEach(tab=>{
    tab.onclick=()=>{
      document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
      tab.classList.add("active");
      editor.setModel(models[tab.dataset.lang]);
    }
  });

  const preview = document.getElementById("preview");

  function runCode(){
    const html = models.html.getValue();
    const css = models.css.getValue();
    const js = models.javascript.getValue();

    preview.srcdoc = `
<!doctype html>
<html>
<head>
<style>${css}</style>
</head>
<body>
${html}
<script>
try{
${js}
}catch(e){
document.body.innerHTML += "<pre style='color:red;font-family:monospace;'>JS Error: "+e.message+"</pre>";
}
<\/script>
</body>
</html>`;
  }

  document.getElementById("runBtn").onclick=runCode;

  document.getElementById("saveBtn").onclick=()=>{
    localStorage.setItem("rbs-html",models.html.getValue());
    localStorage.setItem("rbs-css",models.css.getValue());
    localStorage.setItem("rbs-js",models.javascript.getValue());
    alert("Saved locally.");
  };

  document.getElementById("downloadBtn").onclick=()=>{
    const blob = new Blob([preview.srcdoc],{type:"text/html"});
    const a = document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="project.html";
    a.click();
  };

  document.getElementById("fullBtn").onclick=()=>{
    const wrap=document.querySelector(".previewWrap");
    wrap.classList.toggle("fullPreview");
  };

  document.addEventListener("keydown",e=>{
    if(e.key==="Escape"){
      document.querySelector(".previewWrap").classList.remove("fullPreview");
    }
  });

  runCode();
});
</script>

</body>
</html>
